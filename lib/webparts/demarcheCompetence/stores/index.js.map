{"version":3,"file":"index.js","sourceRoot":"","sources":["../../../../src/webparts/demarcheCompetence/stores/index.ts"],"names":[],"mappings":"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","sourcesContent":["import { createPinia } from 'pinia';\nimport { App } from 'vue';\nimport { WebPartContext } from '@microsoft/sp-webpart-base';\n\n// Import stores\nexport { useAppStore } from './app';\nexport { useQuizStore } from './quiz';\nexport { useUserStore } from './user';\n\n// Import services\nimport { SharePointService } from '@services/SharePointService';\nimport { QuizService } from '@services/QuizService';\nimport { UserService } from '@services/UserService';\n\n// Create pinia instance\nexport const pinia = createPinia();\n\n// Service instances\nlet sharePointService: SharePointService;\nlet quizService: QuizService;\nlet userService: UserService;\n\n/**\n * Initialize stores with SharePoint context and services\n */\nexport function initializeStores(context: WebPartContext) {\n  // Initialize services\n  sharePointService = new SharePointService(context);\n  quizService = new QuizService(sharePointService);\n  userService = new UserService(sharePointService);\n\n  // The stores will be initialized when first accessed\n  // We'll provide the services through the store actions\n}\n\n/**\n * Get service instances\n */\nexport function getServices() {\n  return {\n    sharePointService,\n    quizService,\n    userService\n  };\n}\n\n/**\n * Setup stores for Vue app\n */\nexport function setupStores(app: App, context: WebPartContext) {\n  // Install Pinia\n  app.use(pinia);\n\n  // Initialize services\n  initializeStores(context);\n\n  return {\n    pinia,\n    services: getServices()\n  };\n}\n\n/**\n * Store utilities for common operations\n */\n\nimport { useAppStore } from './app';\nimport { useQuizStore } from './quiz';\nimport { useUserStore } from './user';\n\n/**\n * Initialize all stores with their respective services\n */\nexport async function initializeAllStores() {\n  const appStore = useAppStore();\n  const quizStore = useQuizStore();\n  const userStore = useUserStore();\n\n  try {\n    // Initialize app store first\n    await appStore.initializeApp();\n\n    // Set services in stores\n    quizStore.setQuizService(quizService);\n    userStore.setUserService(userService);\n\n    // Initialize user store\n    await userStore.initializeUser();\n\n    appStore.showSuccessMessage('Application initialisée avec succès');\n  } catch (error) {\n    console.error('Error initializing stores:', error);\n    appStore.showErrorMessage(\n      error instanceof Error ? error.message : 'Erreur lors de l\\'initialisation'\n    );\n    throw error;\n  }\n}\n\n/**\n * Reset all stores to initial state\n */\nexport function resetAllStores() {\n  const appStore = useAppStore();\n  const quizStore = useQuizStore();\n  const userStore = useUserStore();\n\n  quizStore.clearAllData();\n  userStore.clearAllData();\n  appStore.resetApp();\n}\n\n/**\n * Check if all required data is loaded\n */\nexport function isDataLoaded(): boolean {\n  const userStore = useUserStore();\n  const quizStore = useQuizStore();\n\n  return userStore.isAuthenticated && \n         userStore.isUserLoaded &&\n         (quizStore.hasIntroductionQuestions || quizStore.hasSondageQuestions);\n}\n\n/**\n * Refresh all store data\n */\nexport async function refreshAllData() {\n  const appStore = useAppStore();\n  const quizStore = useQuizStore();\n  const userStore = useUserStore();\n\n  try {\n    appStore.setLoading(true);\n\n    await Promise.all([\n      userStore.refreshUserData(),\n      quizStore.loadUserResults(),\n      // Refresh other data as needed\n    ]);\n\n    appStore.updateLastSync();\n    appStore.showSuccessMessage('Données actualisées');\n  } catch (error) {\n    console.error('Error refreshing data:', error);\n    appStore.showErrorMessage(\n      error instanceof Error ? error.message : 'Erreur lors de l\\'actualisation'\n    );\n    throw error;\n  } finally {\n    appStore.setLoading(false);\n  }\n}\n\n/**\n * Handle store errors globally\n */\nexport function handleStoreError(error: Error, operation: string) {\n  const appStore = useAppStore();\n  \n  console.error(`Store error in ${operation}:`, error);\n  \n  appStore.trackError(operation);\n  appStore.showErrorMessage(\n    error.message || 'Une erreur inattendue s\\'est produite',\n    `Erreur - ${operation}`\n  );\n}\n\n/**\n * Track performance for store operations\n */\nexport function trackStoreOperation<T>(\n  operation: string,\n  fn: () => Promise<T>\n): Promise<T> {\n  const appStore = useAppStore();\n  const startTime = performance.now();\n\n  return fn()\n    .then(result => {\n      const duration = performance.now() - startTime;\n      appStore.trackPerformance(operation, duration);\n      return result;\n    })\n    .catch(error => {\n      appStore.trackError(operation);\n      throw error;\n    });\n}\n\n/**\n * Store middleware for automatic error handling\n */\nexport function withErrorHandling<T extends any[], R>(\n  operation: string,\n  fn: (...args: T) => Promise<R>\n) {\n  return async (...args: T): Promise<R> => {\n    try {\n      return await trackStoreOperation(operation, () => fn(...args));\n    } catch (error) {\n      handleStoreError(error as Error, operation);\n      throw error;\n    }\n  };\n}\n\n/**\n * Batch operations utility\n */\nexport async function batchOperations<T>(\n  operations: Array<() => Promise<T>>,\n  concurrency: number = 3\n): Promise<T[]> {\n  const results: T[] = [];\n  \n  for (let i = 0; i < operations.length; i += concurrency) {\n    const batch = operations.slice(i, i + concurrency);\n    const batchResults = await Promise.all(batch.map(op => op()));\n    results.push(...batchResults);\n  }\n  \n  return results;\n}\n\n/**\n * Retry operation utility\n */\nexport async function retryOperation<T>(\n  operation: () => Promise<T>,\n  maxRetries: number = 3,\n  delay: number = 1000\n): Promise<T> {\n  let lastError: Error;\n\n  for (let i = 0; i <= maxRetries; i++) {\n    try {\n      return await operation();\n    } catch (error) {\n      lastError = error as Error;\n      \n      if (i === maxRetries) {\n        throw lastError;\n      }\n\n      // Wait before retrying\n      await new Promise(resolve => setTimeout(resolve, delay * Math.pow(2, i)));\n    }\n  }\n\n  throw lastError!;\n}\n\n/**\n * Cache management for stores\n */\nexport class StoreCache {\n  private cache = new Map<string, { data: any; timestamp: number; ttl: number }>();\n\n  async get<T>(\n    key: string,\n    fetcher: () => Promise<T>,\n    ttl: number = 300000 // 5 minutes default\n  ): Promise<T> {\n    const cached = this.cache.get(key);\n    const now = Date.now();\n\n    if (cached && (now - cached.timestamp) < cached.ttl) {\n      return cached.data;\n    }\n\n    const data = await fetcher();\n    this.cache.set(key, { data, timestamp: now, ttl });\n    return data;\n  }\n\n  invalidate(key: string): void {\n    this.cache.delete(key);\n  }\n\n  clear(): void {\n    this.cache.clear();\n  }\n\n  size(): number {\n    return this.cache.size;\n  }\n}\n\n// Global cache instance\nexport const storeCache = new StoreCache();\n\n/**\n * Type definitions for store composition\n */\nexport interface StoreComposition {\n  app: ReturnType<typeof useAppStore>;\n  quiz: ReturnType<typeof useQuizStore>;\n  user: ReturnType<typeof useUserStore>;\n}\n\n/**\n * Compose all stores for easier access\n */\nexport function useStores(): StoreComposition {\n  return {\n    app: useAppStore(),\n    quiz: useQuizStore(),\n    user: useUserStore()\n  };\n}"]}