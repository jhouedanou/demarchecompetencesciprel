{"version":3,"file":"DemarcheCompetenceWebPart.js","sourceRoot":"","sources":["../../../src/webparts/demarcheCompetence/DemarcheCompetenceWebPart.ts"],"names":[],"mappings":"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","sourcesContent":["import { Version } from '@microsoft/sp-core-library';\nimport {\n  type IPropertyPaneConfiguration,\n  PropertyPaneTextField,\n  PropertyPaneToggle,\n  PropertyPaneDropdown,\n  PropertyPaneSlider\n} from '@microsoft/sp-property-pane';\nimport { BaseClientSideWebPart } from '@microsoft/sp-webpart-base';\nimport { escape } from '@microsoft/sp-lodash-subset';\n\nimport { createApp } from 'vue';\nimport type { App as VueApp } from 'vue';\n\n// Import main Vue app component\nimport DemarcheCompetenceApp from './app/DemarcheCompetenceApp.vue';\n\n// Import store setup\nimport { setupStores, initializeAllStores } from '@stores/index';\n\n// Import styles\nimport './app/styles/main.scss';\n\nexport interface IDemarcheCompetenceWebPartProps {\n  title: string;\n  description: string;\n  showTitle: boolean;\n  autoSaveEnabled: boolean;\n  autoSaveInterval: number;\n  theme: 'light' | 'dark' | 'auto';\n  compactMode: boolean;\n  enableNotifications: boolean;\n  enableAnimations: boolean;\n  debugMode: boolean;\n}\n\nexport default class DemarcheCompetenceWebPart extends BaseClientSideWebPart<IDemarcheCompetenceWebPartProps> {\n  private vueApp: VueApp | null = null;\n\n  protected async onInit(): Promise<void> {\n    await super.onInit();\n    \n    // Initialize performance tracking\n    const startTime = performance.now();\n    \n    try {\n      // Log initialization start\n      console.log('Initializing Démarche Compétence WebPart...');\n      \n      // Validate SharePoint context\n      if (!this.context) {\n        throw new Error('SharePoint context not available');\n      }\n\n      // Check required permissions\n      await this.checkPermissions();\n      \n      // Log successful initialization\n      const initTime = performance.now() - startTime;\n      console.log(`WebPart initialized successfully in ${initTime.toFixed(2)}ms`);\n      \n    } catch (error) {\n      console.error('Error initializing WebPart:', error);\n      this.showErrorMessage('Erreur lors de l\\'initialisation de l\\'application');\n      throw error;\n    }\n  }\n\n  public render(): void {\n    try {\n      // Destroy existing Vue app if it exists\n      if (this.vueApp) {\n        this.vueApp.unmount();\n        this.vueApp = null;\n      }\n\n      // Create container element\n      this.domElement.innerHTML = `\n        <div id=\"demarche-competence-app\" \n             data-title=\"${escape(this.properties.title || 'Démarche Compétence CIPREL')}\"\n             data-theme=\"${escape(this.properties.theme || 'auto')}\"\n             data-compact=\"${this.properties.compactMode || false}\"\n             data-debug=\"${this.properties.debugMode || false}\">\n          <div class=\"loading-container\">\n            <div class=\"loading-spinner\"></div>\n            <p>Chargement de l'application...</p>\n          </div>\n        </div>\n      `;\n\n      // Initialize Vue application\n      this.initializeVueApp();\n\n    } catch (error) {\n      console.error('Error rendering WebPart:', error);\n      this.showErrorMessage('Erreur lors du rendu de l\\'application');\n    }\n  }\n\n  private async initializeVueApp(): Promise<void> {\n    try {\n      // Create Vue app instance\n      this.vueApp = createApp(DemarcheCompetenceApp, {\n        webPartProperties: this.properties,\n        webPartContext: this.context,\n        domElement: this.domElement\n      });\n\n      // Setup stores with SharePoint context\n      const { pinia, services } = setupStores(this.vueApp, this.context);\n\n      // Provide additional dependencies\n      this.vueApp.provide('webPartContext', this.context);\n      this.vueApp.provide('webPartProperties', this.properties);\n      this.vueApp.provide('services', services);\n      this.vueApp.provide('sharePointService', services.sharePointService);\n\n      // Mount the app\n      this.vueApp.mount('#demarche-competence-app');\n\n      // Initialize stores after mounting\n      await initializeAllStores();\n\n      console.log('Vue application mounted successfully');\n\n    } catch (error) {\n      console.error('Error initializing Vue app:', error);\n      this.showErrorMessage('Erreur lors de l\\'initialisation de l\\'interface');\n      throw error;\n    }\n  }\n\n  private async checkPermissions(): Promise<void> {\n    try {\n      // Check if user has access to required SharePoint lists\n      const listsToCheck = ['Quiz_Introduction', 'Quiz_Sondage', 'Quiz_Results', 'User_Progress'];\n      \n      for (const listTitle of listsToCheck) {\n        // This would be implemented with actual permission checking\n        // For now, we'll assume permissions are available\n        console.log(`Checking permissions for list: ${listTitle}`);\n      }\n      \n    } catch (error) {\n      console.warn('Permission check failed:', error);\n      // Continue anyway - permissions will be checked when actually accessing lists\n    }\n  }\n\n  private showErrorMessage(message: string): void {\n    this.domElement.innerHTML = `\n      <div class=\"error-container\">\n        <div class=\"error-icon\">⚠️</div>\n        <h3>Erreur d'Application</h3>\n        <p>${escape(message)}</p>\n        <button onclick=\"location.reload()\" class=\"retry-button\">\n          Réessayer\n        </button>\n      </div>\n    `;\n  }\n\n  protected onDispose(): void {\n    try {\n      // Cleanup Vue app\n      if (this.vueApp) {\n        this.vueApp.unmount();\n        this.vueApp = null;\n      }\n\n      // Clear DOM\n      if (this.domElement) {\n        this.domElement.innerHTML = '';\n      }\n\n      console.log('WebPart disposed successfully');\n    } catch (error) {\n      console.error('Error disposing WebPart:', error);\n    }\n  }\n\n  protected get dataVersion(): Version {\n    return Version.parse('1.0');\n  }\n\n  protected getPropertyPaneConfiguration(): IPropertyPaneConfiguration {\n    return {\n      pages: [\n        {\n          header: {\n            description: 'Configuration de l\\'application Démarche Compétence'\n          },\n          groups: [\n            {\n              groupName: 'Paramètres Généraux',\n              groupFields: [\n                PropertyPaneTextField('title', {\n                  label: 'Titre de l\\'application',\n                  value: 'Démarche Compétence CIPREL'\n                }),\n                PropertyPaneTextField('description', {\n                  label: 'Description',\n                  multiline: true,\n                  rows: 3,\n                  value: 'Application de gestion des compétences pour CIPREL'\n                }),\n                PropertyPaneToggle('showTitle', {\n                  label: 'Afficher le titre',\n                  checked: true\n                })\n              ]\n            },\n            {\n              groupName: 'Paramètres de Fonctionnement',\n              groupFields: [\n                PropertyPaneToggle('autoSaveEnabled', {\n                  label: 'Sauvegarde automatique activée',\n                  checked: true\n                }),\n                PropertyPaneSlider('autoSaveInterval', {\n                  label: 'Intervalle de sauvegarde (secondes)',\n                  min: 10,\n                  max: 300,\n                  step: 10,\n                  value: 30,\n                  showValue: true,\n                  disabled: !this.properties.autoSaveEnabled\n                }),\n                PropertyPaneDropdown('theme', {\n                  label: 'Thème',\n                  options: [\n                    { key: 'auto', text: 'Automatique' },\n                    { key: 'light', text: 'Clair' },\n                    { key: 'dark', text: 'Sombre' }\n                  ],\n                  selectedKey: 'auto'\n                })\n              ]\n            },\n            {\n              groupName: 'Interface Utilisateur',\n              groupFields: [\n                PropertyPaneToggle('compactMode', {\n                  label: 'Mode compact',\n                  checked: false\n                }),\n                PropertyPaneToggle('enableNotifications', {\n                  label: 'Notifications activées',\n                  checked: true\n                }),\n                PropertyPaneToggle('enableAnimations', {\n                  label: 'Animations activées',\n                  checked: true\n                })\n              ]\n            },\n            {\n              groupName: 'Développement',\n              groupFields: [\n                PropertyPaneToggle('debugMode', {\n                  label: 'Mode debug',\n                  checked: false\n                })\n              ]\n            }\n          ]\n        }\n      ]\n    };\n  }\n\n  protected onPropertyPaneFieldChanged(propertyPath: string, oldValue: any, newValue: any): void {\n    // Handle property changes that require re-rendering\n    if (['theme', 'compactMode', 'title'].includes(propertyPath)) {\n      this.render();\n    }\n\n    // Handle auto-save interval changes\n    if (propertyPath === 'autoSaveEnabled' && !newValue) {\n      // Disable auto-save if toggled off\n      this.properties.autoSaveInterval = 0;\n    }\n\n    super.onPropertyPaneFieldChanged(propertyPath, oldValue, newValue);\n  }\n\n  protected get disableReactivePropertyChanges(): boolean {\n    return false;\n  }\n}"]}