{"version":3,"file":"DemarcheCompetenceWebPart.js","sourceRoot":"","sources":["../../../src/webparts/demarcheCompetence/DemarcheCompetenceWebPart.ts"],"names":[],"mappings":"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","sourcesContent":["import { Version } from '@microsoft/sp-core-library';\nimport {\n  type IPropertyPaneConfiguration,\n  PropertyPaneTextField,\n  PropertyPaneToggle,\n  PropertyPaneDropdown,\n  PropertyPaneSlider\n} from '@microsoft/sp-property-pane';\nimport { BaseClientSideWebPart } from '@microsoft/sp-webpart-base';\nimport { escape } from '@microsoft/sp-lodash-subset';\n\nimport * as React from 'react';\nimport * as ReactDom from 'react-dom';\nimport { Provider } from 'react-redux';\n\n// Import main React app component\nimport DemarcheCompetenceApp from './app/DemarcheCompetenceApp';\n\n// Import store setup\nimport { setupStore, initializeAllStores } from '@stores/index';\n\n// Import styles\nimport './app/styles/main.scss';\n\nexport interface IDemarcheCompetenceWebPartProps {\n  title: string;\n  description: string;\n  showTitle: boolean;\n  autoSaveEnabled: boolean;\n  autoSaveInterval: number;\n  theme: 'light' | 'dark' | 'auto';\n  compactMode: boolean;\n  enableNotifications: boolean;\n  enableAnimations: boolean;\n  debugMode: boolean;\n}\n\nexport default class DemarcheCompetenceWebPart extends BaseClientSideWebPart<IDemarcheCompetenceWebPartProps> {\n  private store: any = null;\n\n  protected async onInit(): Promise<void> {\n    await super.onInit();\n    \n    // Initialize performance tracking\n    const startTime = performance.now();\n    \n    try {\n      // Log initialization start\n      console.log('Initializing Démarche Compétence WebPart...');\n      \n      // Validate SharePoint context\n      if (!this.context) {\n        throw new Error('SharePoint context not available');\n      }\n\n      // Check required permissions\n      await this.checkPermissions();\n      \n      // Log successful initialization\n      const initTime = performance.now() - startTime;\n      console.log(`WebPart initialized successfully in ${initTime.toFixed(2)}ms`);\n      \n    } catch (error) {\n      console.error('Error initializing WebPart:', error);\n      this.showErrorMessage('Erreur lors de l\\'initialisation de l\\'application');\n      throw error;\n    }\n  }\n\n  public render(): void {\n    try {\n      // Clear existing React app if it exists\n      if (this.domElement) {\n        ReactDom.unmountComponentAtNode(this.domElement);\n      }\n\n      // Create container element\n      this.domElement.innerHTML = `\n        <div id=\"demarche-competence-app\" \n             data-title=\"${escape(this.properties.title || 'Démarche Compétence CIPREL')}\"\n             data-theme=\"${escape(this.properties.theme || 'auto')}\"\n             data-compact=\"${this.properties.compactMode || false}\"\n             data-debug=\"${this.properties.debugMode || false}\">\n          <div class=\"loading-container\">\n            <div class=\"loading-spinner\"></div>\n            <p>Chargement de l'application...</p>\n          </div>\n        </div>\n      `;\n\n      // Initialize React application\n      this.initializeReactApp();\n\n    } catch (error) {\n      console.error('Error rendering WebPart:', error);\n      this.showErrorMessage('Erreur lors du rendu de l\\'application');\n    }\n  }\n\n  private async initializeReactApp(): Promise<void> {\n    try {\n      // Setup Redux store with SharePoint context\n      this.store = setupStore(this.context);\n\n      // Create React element with children\n      const element: React.ReactElement = React.createElement(\n        Provider,\n        { store: this.store },\n        React.createElement(DemarcheCompetenceApp, {\n          webPartProperties: this.properties,\n          webPartContext: this.context,\n          domElement: this.domElement\n        })\n      );\n\n      // Render the app\n      ReactDom.render(element, this.domElement.querySelector('#demarche-competence-app'));\n\n      // Initialize stores after mounting\n      await initializeAllStores(this.store, this.context);\n\n      console.log('React application mounted successfully');\n\n    } catch (error) {\n      console.error('Error initializing React app:', error);\n      this.showErrorMessage('Erreur lors de l\\'initialisation de l\\'interface');\n      throw error;\n    }\n  }\n\n  private async checkPermissions(): Promise<void> {\n    try {\n      // Check if user has access to required SharePoint lists\n      const listsToCheck = ['Quiz_Introduction', 'Quiz_Sondage', 'Quiz_Results', 'User_Progress'];\n      \n      for (const listTitle of listsToCheck) {\n        // This would be implemented with actual permission checking\n        // For now, we'll assume permissions are available\n        console.log(`Checking permissions for list: ${listTitle}`);\n      }\n      \n    } catch (error) {\n      console.warn('Permission check failed:', error);\n      // Continue anyway - permissions will be checked when actually accessing lists\n    }\n  }\n\n  private showErrorMessage(message: string): void {\n    this.domElement.innerHTML = `\n      <div class=\"error-container\">\n        <div class=\"error-icon\">⚠️</div>\n        <h3>Erreur d'Application</h3>\n        <p>${escape(message)}</p>\n        <button onclick=\"location.reload()\" class=\"retry-button\">\n          Réessayer\n        </button>\n      </div>\n    `;\n  }\n\n  protected onDispose(): void {\n    try {\n      // Cleanup React app\n      if (this.domElement) {\n        ReactDom.unmountComponentAtNode(this.domElement);\n      }\n\n      // Clear store reference\n      this.store = null;\n\n      // Clear DOM\n      if (this.domElement) {\n        this.domElement.innerHTML = '';\n      }\n\n      console.log('WebPart disposed successfully');\n    } catch (error) {\n      console.error('Error disposing WebPart:', error);\n    }\n  }\n\n  protected get dataVersion(): Version {\n    return Version.parse('1.0');\n  }\n\n  protected getPropertyPaneConfiguration(): IPropertyPaneConfiguration {\n    return {\n      pages: [\n        {\n          header: {\n            description: 'Configuration de l\\'application Démarche Compétence'\n          },\n          groups: [\n            {\n              groupName: 'Paramètres Généraux',\n              groupFields: [\n                PropertyPaneTextField('title', {\n                  label: 'Titre de l\\'application',\n                  value: 'Démarche Compétence CIPREL'\n                }),\n                PropertyPaneTextField('description', {\n                  label: 'Description',\n                  multiline: true,\n                  rows: 3,\n                  value: 'Application de gestion des compétences pour CIPREL'\n                }),\n                PropertyPaneToggle('showTitle', {\n                  label: 'Afficher le titre',\n                  checked: true\n                })\n              ]\n            },\n            {\n              groupName: 'Paramètres de Fonctionnement',\n              groupFields: [\n                PropertyPaneToggle('autoSaveEnabled', {\n                  label: 'Sauvegarde automatique activée',\n                  checked: true\n                }),\n                PropertyPaneSlider('autoSaveInterval', {\n                  label: 'Intervalle de sauvegarde (secondes)',\n                  min: 10,\n                  max: 300,\n                  step: 10,\n                  value: 30,\n                  showValue: true,\n                  disabled: !this.properties.autoSaveEnabled\n                }),\n                PropertyPaneDropdown('theme', {\n                  label: 'Thème',\n                  options: [\n                    { key: 'auto', text: 'Automatique' },\n                    { key: 'light', text: 'Clair' },\n                    { key: 'dark', text: 'Sombre' }\n                  ],\n                  selectedKey: 'auto'\n                })\n              ]\n            },\n            {\n              groupName: 'Interface Utilisateur',\n              groupFields: [\n                PropertyPaneToggle('compactMode', {\n                  label: 'Mode compact',\n                  checked: false\n                }),\n                PropertyPaneToggle('enableNotifications', {\n                  label: 'Notifications activées',\n                  checked: true\n                }),\n                PropertyPaneToggle('enableAnimations', {\n                  label: 'Animations activées',\n                  checked: true\n                })\n              ]\n            },\n            {\n              groupName: 'Développement',\n              groupFields: [\n                PropertyPaneToggle('debugMode', {\n                  label: 'Mode debug',\n                  checked: false\n                })\n              ]\n            }\n          ]\n        }\n      ]\n    };\n  }\n\n  protected onPropertyPaneFieldChanged(propertyPath: string, oldValue: any, newValue: any): void {\n    // Handle property changes that require re-rendering\n    if (['theme', 'compactMode', 'title'].includes(propertyPath)) {\n      this.render();\n    }\n\n    // Handle auto-save interval changes\n    if (propertyPath === 'autoSaveEnabled' && !newValue) {\n      // Disable auto-save if toggled off\n      this.properties.autoSaveInterval = 0;\n    }\n\n    super.onPropertyPaneFieldChanged(propertyPath, oldValue, newValue);\n  }\n\n  protected get disableReactivePropertyChanges(): boolean {\n    return false;\n  }\n}\n"]}